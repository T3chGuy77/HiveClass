define(function(){var e=function(n){var n=n||{};this._started=!1,this.compressionLevel=n.compressionLevel||.85,this.captureWidth=n.captureWidth||1920,this.desktopMedia=n.desktopMedia||["screen"],this.video=document.querySelector("video"),this.canvas=document.querySelector("canvas"),this.captureId=null,this.desktopStream=null,this.captureWidth=Math.min(screen.width,this.captureWidth),this._stopping=!1,this.role=n.role||e.ROLES.STUDENT,this._startCapturingDesktop=function(e){var n=this;return new Promise(function(t,o){n.consentScreenDisplayed?o():(n.consentScreenDisplayed=!0,n.captureId=chrome.desktopCapture.chooseDesktopMedia(n.desktopMedia,e,function(e){n.consentScreenDisplayed=!1,e?t({streamId:e}):(n._started=!1,o())}))})},this._stopCapturingDesktop=function(){this._stopping=!0,this.captureId&&(this.consentScreenDisplayed=!1,chrome.desktopCapture.cancelChooseDesktopMedia(this.captureId)),this.desktopStream&&this.desktopStream.stop()},this.start=function(e,n){return this._started=!0,console.log("Starting ShowScreenService"),this._endScreenSharingHandler=n,this._stopping=!1,this._startCapturingDesktop(e)},this.capture=function(){var e;if(this.desktopStream){this.canvas.width=this.video.width=this.captureWidth,this.canvas.height=this.video.clientHeight;var n=this.canvas.getContext("2d");n.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),e=this.canvas.toDataURL("image/webp",this.compressionLevel)}return e},this.stop=function(){console.log("Stopping ShowScreenService"),this._stopCapturingDesktop(),this._started=!1},this.isStarted=function(){return this._started}};return e.ROLES={STUDENT:"STUDENT",TEACHER:"TEACHER"},e});
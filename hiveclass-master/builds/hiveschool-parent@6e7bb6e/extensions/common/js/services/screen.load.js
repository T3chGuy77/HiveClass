montageDefine("6e7bb6e","extensions/common/js/services/screen",{dependencies:[],factory:function(){define(function(){var e=function(t){var t=t||{};this._started=!1,this.compressionLevel=t.compressionLevel||.85,this.captureWidth=t.captureWidth||1920,this.desktopMedia=t.desktopMedia||["screen"],this.video=document.querySelector("video"),this.canvas=document.querySelector("canvas"),this.captureId=null,this.desktopStream=null,this.captureWidth=Math.min(screen.width,this.captureWidth),this._stopping=!1,this.role=t.role||e.ROLES.STUDENT,this._startCapturingDesktop=function(e){var t=this;return new Promise(function(n,o){t.consentScreenDisplayed?o():(t.consentScreenDisplayed=!0,t.captureId=chrome.desktopCapture.chooseDesktopMedia(t.desktopMedia,e,function(e){t.consentScreenDisplayed=!1,e?n({streamId:e}):(t._started=!1,o())}))})},this._stopCapturingDesktop=function(){this._stopping=!0,this.captureId&&(this.consentScreenDisplayed=!1,chrome.desktopCapture.cancelChooseDesktopMedia(this.captureId)),this.desktopStream&&this.desktopStream.stop()},this.start=function(e,t){return this._started=!0,console.log("Starting ShowScreenService"),this._endScreenSharingHandler=t,this._stopping=!1,this._startCapturingDesktop(e)},this.capture=function(){var e;if(this.desktopStream){this.canvas.width=this.video.width=this.captureWidth,this.canvas.height=this.video.clientHeight;var t=this.canvas.getContext("2d");t.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),e=this.canvas.toDataURL("image/webp",this.compressionLevel)}return e},this.stop=function(){console.log("Stopping ShowScreenService"),this._stopCapturingDesktop(),this._started=!1},this.isStarted=function(){return this._started}};return e.ROLES={STUDENT:"STUDENT",TEACHER:"TEACHER"},e})}});